// Copyright 2020 Daniel Erat <dan@erat.org>.
// All rights reserved.

package main

import (
	"fmt"
	"io/ioutil"
	"log"
	"os"
	"path/filepath"
	"strings"
	"text/template"
)

func main() {
	if len(os.Args) < 3 {
		fmt.Fprintf(os.Stderr, "Usage: %s [var] [file]...\n", os.Args[0])
	}

	data := struct {
		Var   string            // name for generated variable
		Files map[string]string // keys are base filenames, values are data
	}{
		Var:   os.Args[1],
		Files: make(map[string]string),
	}

	for _, p := range os.Args[2:] {
		b, err := ioutil.ReadFile(p)
		if err != nil {
			log.Fatal("Failed reading file: ", err)
		}
		data.Files[filepath.Base(p)] = string(b)
	}

	if err := template.Must(template.New("").Parse(strings.TrimLeft(`
// Code generated by gen_filemap.go. DO NOT EDIT.

package render

var {{.Var}} = map[string]string{
{{- range $name, $val := .Files}}
	{{printf "%q" $name}}: {{printf "%q" $val}},
{{- end -}}
}
`, "\n"))).Execute(os.Stdout, &data); err != nil {
		log.Fatal("Failed executing template: ", err)
	}
}
