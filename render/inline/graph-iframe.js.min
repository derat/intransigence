var d=null;function appendGraph(E,m,L,o,C,x,u){z=u?u[0]:d3.min(o,function(e){return e.value}),T=u?u[1]:d3.max(o,function(e){return e.value}),r=d3.min(o,function(e){return e.time}),d=d3.max(o,function(e){return e.time}),e={HALF_HOUR:1,HOUR:2,YEAR:3},d-r<=3*3600?i=e.HALF_HOUR:d-r<=24*3600?i=e.HOUR:i=e.YEAR;function j(n,s){var t=new Date(n*1e3);switch(i){case e.HALF_HOUR:case e.HOUR:return d3.format("02f")(t.getUTCHours())+":"+d3.format("02f")(t.getUTCMinutes());case e.YEAR:return s?t.getUTCFullYear()+'':t.getUTCFullYear()+"-"+d3.format("02f")(t.getUTCMonth()+1)+"-"+d3.format("02f")(t.getUTCDate())}}f=20,F=15,b=20,v=20,M=5;var z,T,r,d,e,i,f,F,b,v,M,c=5,p=3,S=15,A=20,w,y,_,O,l,D,N,h,R,P,k=d3.select(E).append("svg:svg").data([o]).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+m[0]+" "+m[1]).attr("class","graph"),a=m[0]-2*f-b,g=m[1]-2*f-F-v,t=d3.scale.linear().domain([r,d]).range([0,a]),n=d3.scale.linear().domain([z,T]).range([g,0]),s=k.append("svg:g").attr("transform","translate("+(f+b)+","+(f+v)+")");s.append("svg:text").attr("class","title").attr("x",.5*a-b).attr("y",-(v-M)).attr("text-anchor","middle").text(L),w=s.selectAll("rect.note").data(C).enter().append("svg:rect").attr("class","note").attr("x",function(e){return t(e.time)-3}).attr("y",0).attr("width",6).attr("height",g),w.on("mouseover",function(t,e){d3.select(this).transition().duration(150).style("fill","#eee").style("stroke","#ddd"),d3.select(l[0][e]).transition().duration(150).style("opacity",1)}),w.on("mouseout",function(t,e){d3.select(this).transition().duration(300).style("fill","#f5f5f5").style("stroke","#eee"),d3.select(l[0][e]).transition().duration(150).style("opacity",0)}),t.ticks=function(){var o=new Date(r*1e3),s,a=new Date(d*1e3),t=new Date(r*1e3),n=null;switch(i){case e.HALF_HOUR:case e.HOUR:t.setUTCMinutes(0),t.setUTCSeconds(0),n=i==e.HALF_HOUR?function(e){e.setUTCMinutes(e.getUTCMinutes()+30)}:function(e){e.setUTCHours(e.getUTCHours()+1)};break;case e.YEAR:t.setUTCMonth(0),t.setUTCDate(1),t.setUTCHours(0),t.setUTCMinutes(0),t.setUTCSeconds(0),n=function(e){e.setUTCFullYear(e.getUTCFullYear()+1)};break}for(s=[];t<a;n(t))t>=o&&s.push(t.getTime()/1e3);return s},y=s.selectAll("g.xrule").data(t.ticks(10)).enter().append("svg:g").attr("class","rule"),y.append("svg:line").attr("x1",t).attr("x2",t).attr("y1",0).attr("y2",g-1),y.append("svg:text").attr("x",t).attr("y",g+15).attr("dy",".71em").attr("text-anchor","middle").text(function(e){return j(e,!0)}),_=s.selectAll("g.yrule").data(n.ticks(10)).enter().append("svg:g").attr("class","rule"),_.append("svg:line").attr("y1",n).attr("y2",n).attr("x1",0).attr("x2",a+1),_.append("svg:text").attr("y",n).attr("x",-10).attr("dy",".35em").attr("text-anchor","end").text(n.tickFormat(10)),s.append("svg:path").attr("class","line").attr("pointer-events","none").attr("d",d3.svg.line().x(function(e){return t(e.time)}).y(function(e){return n(e.value)})),O=s.selectAll("circle.line").data(o).enter().append("svg:circle").attr("class","line").attr("cx",function(e){return t(e.time)}).attr("cy",function(e){return n(e.value)}).attr("r",3.5),O.on("mouseover",function(t,e){d3.select(this).transition().duration(150).style("fill","steelblue"),d3.select(h[0][e]).transition().duration(150).style("opacity",1)}),O.on("mouseout",function(t,e){d3.select(this).transition().duration(300).style("fill","white"),d3.select(h[0][e]).transition().duration(150).style("opacity",0)}),l=s.selectAll("g.noteLabel").data(C).enter().append("svg:g").attr("class","noteLabel label").attr("pointer-events","none").attr("opacity",0),D=l.append("svg:rect"),N=l.append("svg:text").attr("text-anchor","middle").text(function(e){return j(e.time,!1)+": "+e.text}).attr("x",function(e){return Math.max(.5*this.getBBox().width,Math.min(a-.5*this.getBBox().width,t(e.time)))}).attr("y",A),D.data(N[0]).attr("x",function(e){return e.getBBox().x-c}).attr("y",function(e){return e.getBBox().y-p}).attr("width",function(e){return e.getBBox().width+2*c}).attr("height",function(e){return e.getBBox().height+2*p}),h=s.selectAll("g.dataLabel").data(o).enter().append("svg:g").attr("class","dataLabel label").attr("pointer-events","none").attr("opacity",0),R=h.append("svg:rect"),P=h.append("svg:text").attr("text-anchor","middle").text(function(e){return j(e.time,!1)+": "+e.value+(x?' '+x:'')}).attr("x",function(e){return Math.max(.5*this.getBBox().width,Math.min(a-.5*this.getBBox().width,t(e.time)))}).attr("y",function(e){return n(e.value)-S}),R.data(P[0]).attr("x",function(e){return e.getBBox().x-c}).attr("y",function(e){return e.getBBox().y-p}).attr("width",function(e){return e.getBBox().width+2*c}).attr("height",function(e){return e.getBBox().height+2*p})}function initPage(){var e=window.location.search.substring(1);if(d=dataSets[e],!d)throw'Data not found for "'+e+"'";appendGraph('#graph-node',[window.innerWidth,window.innerHeight],d.title,d.points,d.notes,d.units,d.range)}document.addEventListener('DOMContentLoaded',initPage,!1)